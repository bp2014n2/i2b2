<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<!--  
select   patient_num ,1 as panel_count  from ( select  /*+ index(observation_fact fact_cnpt_pat_enct_idx) */  patient_num  from i2b2demodata2.dbo.patient_dimension where  patient_num IN (select patient_num from i2b2demodata2.dbo.patient_dimension    where birth_date BETWEEN getdate() - (365.25*18) + 1 AND getdate() - (365.25*10) +1)    group by   patient_num  ) t
<*>
 update i2b2demodata2.dbo.#global_temp_table set panel_count =2 where    exists ( select  1 as panel_count  from ( select  /*+ index(observation_fact fact_cnpt_pat_enct_idx) */  patient_num  from i2b2demodata2.dbo.visit_dimension where  encounter_num IN (select encounter_num from i2b2demodata2.dbo.visit_dimension    where start_date BETWEEN ((select birth_date from i2b2demodata2.dbo.patient_dimension where patient_num = i2b2demodata2.dbo.visit_dimension.patient_num) + (365.25 * 10)-1) AND ((select birth_date from i2b2demodata2.dbo.patient_dimension where patient_num = i2b2demodata2.dbo.visit_dimension.patient_num) + (365.25 * 18)-1))    group by   patient_num  ) t where i2b2demodata2.dbo.#global_temp_table.panel_count =  1 and i2b2demodata2.dbo.#global_temp_table.patient_num = t.patient_num    ) 
<*>
 update i2b2demodata2.dbo.#global_temp_table set panel_count =3 where    exists ( select  1 as panel_count  from ( select  /*+ index(observation_fact observation_fact_pk) */  patient_num  from i2b2demodata2.dbo.observation_fact where  provider_id IN (select provider_id from i2b2demodata2.dbo.provider_dimension    where provider_path LIKE '\i2b2\Providers\Medicine\Primary Care\Winchester, Charles Emerson, MD\%')     group by   patient_num  ) t where i2b2demodata2.dbo.#global_temp_table.panel_count =  2 and i2b2demodata2.dbo.#global_temp_table.patient_num = t.patient_num    ) 
<*>
 insert into i2b2demodata2.dbo.#dx (  patient_num   ) select * from ( select distinct  patient_num  from i2b2demodata2.dbo.#global_temp_table where panel_count = 3 ) q                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      <?xml version="1.0" encoding="UTF-8" standalone="yes"?>
-->
<ns6:request xmlns:ns2="http://www.i2b2.org/xsd/hive/pdo/1.1/" xmlns:ns4="http://www.i2b2.org/xsd/cell/crc/psm/1.1/" xmlns:ns3="http://www.i2b2.org/xsd/cell/crc/pdo/1.1/" xmlns:ns5="http://www.i2b2.org/xsd/hive/plugin/" xmlns:ns6="http://www.i2b2.org/xsd/hive/msg/1.1/" xmlns:ns7="http://www.i2b2.org/xsd/cell/ont/1.1/" xmlns:ns8="http://www.i2b2.org/xsd/cell/crc/psm/querydefinition/1.1/">
	<message_header>
		<i2b2_version_compatible>1.1</i2b2_version_compatible>
        <sending_application>
            <application_name>i2b2 Query Tool</application_name>
            <application_version>1.6</application_version>
        </sending_application>
        <sending_facility>
            <facility_name>i2b2 Hive</facility_name>
        </sending_facility>
        <receiving_application>
            <application_name>CRC Cell</application_name>
            <application_version>1.6</application_version>
        </receiving_application>
        <receiving_facility>
            <facility_name>i2b2 Hive</facility_name>
        </receiving_facility>
        <datetime_of_message>2012-02-06T14:24:54.348-05:00</datetime_of_message>
        <security>
            <domain>i2b2demo</domain>
            <username>demo</username>
            <password>demouser</password>
        </security>
        <message_type>
            <message_code>Q04</message_code>
            <event_type>EQQ</event_type>
        </message_type>
        <message_control_id>
            <message_num>yfMqNOUXQxzVpLkBJk9m</message_num>
            <instance_num>0</instance_num>
        </message_control_id>
        <processing_id>
            <processing_id>P</processing_id>
            <processing_mode>I</processing_mode>
        </processing_id>
        <accept_acknowledgement_type>AL</accept_acknowledgement_type>
        <application_acknowledgement_type>AL</application_acknowledgement_type>
        <country_code>US</country_code>
        <project_id>Demo</project_id>
    </message_header>
    <request_header>
        <result_waittime_ms>180000</result_waittime_ms>
    </request_header>
    <message_body>
        <ns4:psmheader>
            <user group="i2b2demo" login="demo">demo</user>
            <patient_set_limit>0</patient_set_limit>
            <estimated_time>0</estimated_time>
            <query_mode>optimize_without_temp_table</query_mode>
            <request_type>CRC_QRY_runQueryInstance_fromQueryDefinition</request_type>
        </ns4:psmheader>
        <ns4:request xsi:type="ns4:query_definition_requestType" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
            <query_definition>
                <query_name>  10-- Visi-Winch@02:32:28</query_name>
                <query_timing>ANY</query_timing>
                <specificity_scale>0</specificity_scale>
                <panel>
                    <panel_number>1</panel_number>
                    <panel_timing>ANY</panel_timing>
                    <panel_accuracy_scale>100</panel_accuracy_scale>
                    <invert>0</invert>
                    <total_item_occurrences>1</total_item_occurrences>
                    <item>
                        <hlevel>3</hlevel>
                        <item_name>  10-17 years old</item_name>
                        <item_key>\\i2b2_DEMO\i2b2\Demographics\Age\10-17 years old\</item_key>
                        <item_icon>FA</item_icon>
                        <tooltip>Demographics \ Age \ 10-17 years old</tooltip>
                        <class>ENC</class>
                        <item_is_synonym>false</item_is_synonym>
                    </item>
                </panel>
                 <panel>
                    <panel_number>2</panel_number>
                    <panel_timing>ANY</panel_timing>
                    <panel_accuracy_scale>100</panel_accuracy_scale>
                    <invert>0</invert>
                    <total_item_occurrences>1</total_item_occurrences>
                    <item>
                        <hlevel>3</hlevel>
                        <item_name> Visit at ages 10-17 years old</item_name>
                        <item_key>\\i2b2_VISIT\i2b2\Visit Details\Age at visit\10-17 years old\</item_key>
                        <item_icon>FA</item_icon>
                        <tooltip>Visit Details \ Age at visit \ 10-17 years old</tooltip>
                        <class>ENC</class>
                        <item_is_synonym>false</item_is_synonym>
                    </item>
                </panel>
                 <panel>
                    <panel_number>3</panel_number>
                    <panel_timing>ANY</panel_timing>
                    <panel_accuracy_scale>100</panel_accuracy_scale>
                    <invert>0</invert>
                    <total_item_occurrences>1</total_item_occurrences>
                    <item>
                        <hlevel>3</hlevel>
                        <item_name>Winchester, Charles Emerson, MD</item_name>
                        <item_key>\\i2b2_PROV\i2b2\Providers\Medicine\Primary Care\Winchester, Charles Emerson, MD\</item_key>
                        <item_icon>LA</item_icon>
                        <tooltip>i2b2 \ Providers \ Medicine \ Primary Care  \ Winchester, Charles Emerson, MD</tooltip>
                        <class>ENC</class>
                        <item_is_synonym>false</item_is_synonym>
                    </item>
                </panel>
            </query_definition>
            <result_output_list>
                <result_output priority_index="1" name="PATIENT_COUNT_XML"/>
            </result_output_list>
        </ns4:request>
    </message_body>
</ns6:request>



